{
  "/www/ajax-script.js": "/*\n * This file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\n * Contributors: Sam Groveman\n * \n * This file contains AJAX functions for POST, PUT, and GET methods, as well as a file upload handler.\n * Please ensure the correct HTML elements are present in your page to use these functions.\n */\n\n// Send a POST request with an optional object of key/value pairs for parameters\n// Returns the response to the optional callback provided\nfunction POSTRequest(path, successMessage, params = {}, callback = null) {\n\tlet xhr = new XMLHttpRequest(), data = new FormData();\n\txhr.responseType = 'json';\n\tif (Object.keys(params).length !== 0 ) {\n\t\tfor (let param in params) {\n\t\t\tdata.append(param, params[param]);\n\t\t}\n\t}\n\txhr.open('POST', path);\n\txhr.onload = function() {\n\t\tif (this.status !== 200) {\n\t\t\tdocument.getElementById('message').innerHTML = this.response;\n\t\t} else {\n\t\t\tdocument.getElementById('message').innerHTML = successMessage;\n\t\t\tif (callback !== null) {\n\t\t\t\tlet response = xhr.response;\n\t\t\t\tconsole.log(response);\n\t\t\t\tcallback(response);\n\t\t\t}\n\t\t}\n\t};\n\txhr.send(data); \n}\n\n// Send a PUT request with an optional object of key/value pairs for parameters\n// Returns the response to the optional callback provided\nfunction PUTRequest(path, successMessage, params = {}, callback = null) {\n\tlet xhr = new XMLHttpRequest(), data = new FormData();\n\txhr.responseType = 'json';\n\tif (Object.keys(params).length !== 0 ) {\n\t\tfor (let param in params) {\n\t\t\tdata.append(param, params[param]);\n\t\t}\n\t}\n\txhr.open('PUT', path);\n\txhr.onload = function() {\n\t\tif (this.status != 200) {\n\t\t\tdocument.getElementById('message').innerHTML = this.response;\n\t\t} else {\n\t\t\tdocument.getElementById('message').innerHTML = successMessage;\n\t\t\tif (callback !== null) {\n\t\t\t\tlet response = xhr.response;\n\t\t\t\tconsole.log(response);\n\t\t\t\tcallback(response);\n\t\t\t}\n\t\t}\n\t};\n\txhr.send(data);\n}\n\n// Send a GET request with an optional object of key value pairs for parameters\n// Returns the response to the optional callback provided\nfunction GETRequest(path, callback = null, params = {}) {\n    let xhr = new XMLHttpRequest();\n\txhr.responseType = 'json';\n    if (Object.keys(params).length !== 0 ) {\n\t\tlet first = true\n\t\tpath += \"?\";\n\t\tfor (let param in params) {\n\t\t\tif (first) {\n\t\t\t\tfirst = false;\n\t\t\t} else {\n\t\t\t\tpath += \"&\";\n\t\t\t}\n\t\t\tpath += param + \"=\" + params[param];\n\t\t}\n\t}\n    xhr.open('GET', path);\n\txhr.onload = function() {\n\t\tif (this.status != 200) {\n\t\t\tdocument.getElementById('message').innerHTML = this.response;\n\t\t} else if (callback !== null) {\n\t\t\tlet response = xhr.response;\n\t\t\tconsole.log(response);\n\t\t\tcallback(response);\n\t\t}\n\t};\n\txhr.send();\n}\n\n// File upload handler. Call uprog.init() first then call uprog.upload(\"<path>\")\nlet uprog = {\n\thBar: null,\n\thPercent: null,\n\thFile: null,\n\tinit: () => {\n\t\tuprog.hBar = document.getElementById('up-bar');\n\t\tuprog.hPercent = document.getElementById('up-percent');\n\t\tuprog.hFile = document.getElementById('up-file');\n\t\tuprog.hFile.disabled = false;\n\t},\n\tupdate: (percent) => {\n\t\tlet Percent = percent + '%';\n\t\tuprog.hBar.style.width = Percent;\n\t\tuprog.hPercent.innerHTML = Percent;\n\t\tif (Percent == '100%') { uprog.hFile.disabled = false; }\n\t},\n\tupload: (path) => {\n\t\tif (uprog.hFile.files.length == 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet file = uprog.hFile.files[0];\n\t\tuprog.hFile.disabled = true;\n\t\tuprog.hFile.value = '';\n\t\tlet xhr = new XMLHttpRequest(), data = new FormData();\n\t\tdata.append('upfile', file);\n\t\txhr.open('POST', '/upload-file');\n\t\txhr.setRequestHeader('FILE_UPLOAD_PATH', path);\n\t\tlet percent = 0;\n\t\txhr.upload.onloadstart = () => { uprog.update(0); };\n\t\txhr.upload.onloadend = () => { uprog.update(100); };\n\t\txhr.upload.onprogress = (evt) => {\n\t\t\tpercent = Math.ceil((evt.loaded / evt.total) * 100);\n\t\t\tuprog.update(percent);\n\t\t};\n\t\txhr.onload = function() {\n\t\t\tif (this.status == 507) {\n\t\t\t\tdocument.getElementById('message').innerHTML = \"Not enough free storage for file!\";\n\t\t\t} else if (this.status != 201) {\n\t\t\t\tdocument.getElementById('message').innerHTML = this.response;\n\t\t\t} else {\n\t\t\t\tuprog.update(100);\n\t\t\t\tdocument.getElementById('message').innerHTML = 'File uploaded!';\n\t\t\t\tupdateFileList();\n\t\t\t\tgetFreeStorage();\n\t\t\t}\n\t\t};\n\t\txhr.send(data);\n\t}\n};",
  "/www/calibrate-script.js": "/*\n* This file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\n* Contributors: Sam Groveman\n*/\n\nlet sensorID = 0;\nlet calibrationStep = 0;\n\nconst calibrationResponse = Object.freeze({\n\terror: 0,\n\tdone: 1,\n\tnext: 2\n});\n\n// Run code when page DOM is loaded\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\tconst urlParams = new URLSearchParams(window.location.search);\n\tconsole.log(urlParams);\n\tconst holder = document.getElementById('calstep');\n\tif (!urlParams.has('id')) {\n\t\tholder.innerHTML = '<h2>No device selected</h2>'\n\t} else {\n\t\tif (urlParams.has('step')) { \n\t\t\tcalibrationStep = parseInt(urlParams.get('step'));\n\t\t}\n\t\tsensorID = parseInt(urlParams.get('id'));\n\t\tdoCalibrationStep(calibrationStep);\n\t}\n});\n\n// Runs a calibration step\nfunction doCalibrationStep(step) {\n\tPOSTRequest('/sensors/calibrate', 'Calibrating...', {\"sensor\": sensorID, \"step\": step}, receiveCalibrationResponse);\n}\n\n// Receives and processes the response of a calibration step\nfunction receiveCalibrationResponse(response) {\n\tconst holder = document.getElementById(\"calstep\");\n\tif (response.response === calibrationResponse.error) {\n\t\tholder.innerHTML = '<h2>Calibration error!</h2><p>' + response.message + '</p>';\n\t} else if (response.response === calibrationResponse.done) {\n\t\tholder.innerHTML = '<h2>Calibration done!</h2><p>' + response.message + '</p><div class=\"button-container\"><a href=\"/devices.html\" class=\"def-button\">Finish</a></div>';\n\t} else if (response.response === calibrationResponse.next) {\n\t\tlet content = '<h2>Calibration Step ' + calibrationStep + ' Completed</h2>';\n\t\tcalibrationStep++;\n\t\tcontent += '<p>' + response.message + '</p>'\n\t\tcontent += '<div class=\"button-container\"><button class=\"def-button\" onclick=\"doCalibrationStep(' + calibrationStep + ')\">Next</button></div>';\n\t\tholder.innerHTML = content;\n\t}\n}",
  "/www/calibrate.html": "<!--\nThis file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\nContributors: Sam Groveman\n-->\n<!DOCTYPE html>\n<html lang=\"en-us\">\n\t<head>        \n\t\t<link rel=\"stylesheet\" href=\"/main.css\">\n\t\t<script src=\"/ajax-script.js\"></script>\n\t\t<script src=\"/calibrate-script.js\"></script>\n\t\t<title>ESP32 Device Hub | Device Calibration</title>\n\t</head>\n\t<body>\n\t\t<div id=\"wrapper\">\n\t\t\t<h1>Device Calibration</h1>\n\t\t\t<div id=\"message\"></div>\n\t\t\t<div id=\"calstep\"></div>\n\t\t</div>\n\t</body>\n</html>",
  "/www/config-script.js": "/*\n* This file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\n* Contributors: Sam Groveman\n*/\n\n// Run code when page DOM is loaded\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\tGETRequest(\"/config/\", addSettings);\n\tGETRequest('/time', addTime);\n\n});\n\n// Adds all settings to page\nfunction addSettings(config) {\n\tconst holder = document.getElementById(\"settings\");\n\tif (Object.keys(config).length === 0 ) {\n\t\tholder.innerHTML += '<p>No configurable options</p>';\n\t} else {\n\t\tfor (opt in config) {\n\t\t\tlet type = \"text\";\n\t\t\tlet step = 1;\n\t\t\tlet additionalAttrb = \"\";\n\t\t\tlet name = opt.replace(\" \", \"_\");\n\t\t\tif (typeof(config[opt]) === \"object\") {\n\t\t\t\tlet newhtml = '<div class=\"stacked-input\">\\\n\t\t\t\t<label for=\"' + name + '\">' + opt + '</label>\\\n\t\t\t\t<select class=\"normal-input\" name=\"' + name + '\">';\n\t\t\t\tconfig[opt].options.forEach((value) => {\n\t\t\t\t\tif (value === config[opt].current) {\n\t\t\t\t\t\tnewhtml += '<option class=\"normal-input\" value=\"' + value + '\" selected>' + value + '</option>';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewhtml += '<option class=\"normal-input\" value=\"' + value + '\">' + value + '</option>';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tnewhtml += '</select></div>'\n\t\t\t\tholder.innerHTML += newhtml;\n\t\t\t} else {\n\t\t\t\tif (typeof(config[opt]) === \"number\") {\n\t\t\t\t\ttype = \"number\";\n\t\t\t\t\tif (!Number.isInteger(config[opt])) {\n\t\t\t\t\t\tstep = 0.01;\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof(config[opt]) === \"boolean\") {\n\t\t\t\t\ttype = \"checkbox\";\n\t\t\t\t\tif (config[opt] === true) {\n\t\t\t\t\t\tadditionalAttrb= \"checked\";\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof(config[opt]) === \"string\") {\n\t\t\t\t\tconfig[opt] = config[opt].replaceAll('\"', '&quot;');\n\t\t\t\t}\n\t\t\t\tholder.innerHTML += '<div class=\"stacked-input\"><label for=\"' + name + '\">' + opt + '</label>\\\n\t\t\t\t<input class=\"normal-input\" type=\"' + type + '\" name=\"' + name + '\" step=\"' + step + '\" value=\"' + config[opt] + '\" ' + additionalAttrb +'></div>';\n\t\t\t}\n\t\t}\n\t}\n}\n\n// Displays current time on device\nfunction addTime(response) {\n\tconst time = document.getElementById(\"time\");\n\tvar d = new Date(0);\n\td.setUTCSeconds(response);\n\ttime.innerHTML = d.toLocaleString();\n}\n\n// Parses and updates config for the sensor hub\nfunction updateConfig() {\n\tinputs = document.querySelectorAll('#settings input');\n\tlet new_config = {};\n\tArray.from(inputs).forEach((input) => {\n\t\tif (input.type === \"number\") {\n\t\t\tnew_config[input.name] = input.valueAsNumber;\n\t\t} else if (input.type === \"checkbox\") {\n\t\t\tnew_config[input.name] = input.checked;\n\t\t} else {\n\t\t\tnew_config[input.name] = input.value;\n\t\t}\n\t});\n\tinputs = document.querySelectorAll('#device select');\n\tArray.from(inputs).forEach((input) => {\n\t\tnew_config[input.name] = {\"current\": input.value};\n\t});\n\tconsole.log(new_config);\n\tPOSTRequest(\"/config\", \"Settings updated!\", {'save': true, 'config': JSON.stringify(new_config)});\n}",
  "/www/config.html": "<!--\nThis file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\nContributors: Sam Groveman\n-->\n<!DOCTYPE html>\n<html lang=\"en-us\">\n\t<head>        \n\t\t<link rel=\"stylesheet\" href=\"/main.css\">\n\t\t<script src=\"/ajax-script.js\"></script>\n\t\t<script src=\"/config-script.js\"></script>\n\t\t<title>ESP32 Device Hub | Settings</title>\n\t</head>\n\t<body>\n\t\t<div id=\"wrapper\">\n\t\t\t<h1>Settings</h1>\n\t\t\t<h2 id=\"time\"></h2>\n\t\t\t<h2>Manages device hub settings below</h2>\n\t\t\t<div id=\"message\"></div>\n\t\t\t<div id=\"settings\"></div>\n\t\t\t<div class=\"button-container\">\n\t\t\t\t<button class=\"def-button\" id=\"setconfig\" onclick=\"updateConfig()\">Update Config</button>\n\t\t\t</div>\n\t\t</div>\n\t</body>\n</html>",
  "/www/devices-script.js": "/*\n* This file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\n* Contributors: Sam Groveman\n*/\n\n// Run code when page DOM is loaded\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\tGETRequest(\"/sensors/\", addSensors);\n\tGETRequest(\"/actors/\", addActors);\n\n});\n\n// Adds all connected sensors to the page\nfunction addSensors(sensors) {\n\tconst holder = document.getElementById(\"sensors\");\n\tif (sensors.sensors.length === 0) {\n\t\tholder.innerHTML ='<p>No active sensors</p>';\n\t} else {\n\t\tholder.innerHTML = '<div class=\"button-container\">\\r\\n';\n\t\tsensors.sensors.forEach(sensor => {\n\t\t\tholder.innerHTML += '<button class=\"def-button\" onclick=\"loadDevice(true,\\'' + sensor.description.name + '\\',' +  sensor.positionID +')\">' + sensor.description.name + '</button>';\n\t\t});\n\t}\n}\n\n// Adds all connected actors to the page\nfunction addActors(actors) {\n\tconst holder = document.getElementById(\"actors\");\n\tif (actors.actors.length === 0) {\n\t\tholder.innerHTML = '<p>No active actors</p>';\n\t} else {\n\t\tholder.innerHTML = '<div class=\"button-container\">\\r\\n';\n\t\tactors.actors.forEach(actor => {\n\t\t\tholder.innerHTML += '<button class=\"def-button\" onclick=\"loadDevice(false,\\'' + actor.description.name + '\\',' +  actor.positionID +')\">' + actor.description.name + '</button>';\n\t\t});\n\t}\n}\n\n// Adds an actor to the page for configuring\nfunction loadDevice(isSensor, name, posID) {\n\tconst holder = document.getElementById(\"device\");\n\tholder.dataset.posid = posID;\n\tholder.dataset.sensor = isSensor;\n\tdevice.data\n\tholder.innerHTML = '<h2>' + name + '</h2>';\n\tlet path = \"/actors/config\";\n\tlet dataName = \"actor\";\n\tif (isSensor) {\n\t\tpath = \"/sensors/config\";\n\t\tdataName = \"sensor\";\n\t}\n\tdata = {};\n\tdata[dataName] = posID;\n\tGETRequest(path, addDeviceConfig, data);\n}\n\n// Adds a device configuration to the page\nfunction addDeviceConfig(device) {\n\tconst holder = document.getElementById(\"device\");\n\tlet buttons = '<div class=\"button-container\">';\n\tif (Object.keys(device).length === 0 ) {\n\t\tholder.innerHTML = '<p>No configurable options</p>';\n\t} else {\n\t\tfor (let opt in device) {\n\t\t\tlet type = \"text\";\n\t\t\tlet step = 1;\n\t\t\tlet additionalAttrb = \"\";\n\t\t\tlet name = opt.replace(\" \", \"_\");\n\t\t\tif (typeof(device[opt]) === \"object\") {\n\t\t\t\tlet newhtml = '<div class=\"stacked-input\">\\\n\t\t\t\t<label for=\"' + name + '\">' + opt + '</label>\\\n\t\t\t\t<select class=\"normal-input\" name=\"' + name + '\">';\n\t\t\t\tdevice[opt].options.forEach((value) => {\n\t\t\t\t\tif (value === device[opt].current) {\n\t\t\t\t\t\tnewhtml += '<option class=\"normal-input\" value=\"' + value + '\" selected>' + value + '</option>';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnewhtml += '<option class=\"normal-input\" value=\"' + value + '\">' + value + '</option>';\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tnewhtml += '</select></div>'\n\t\t\t\tholder.innerHTML += newhtml;\n\t\t\t} else {\n\t\t\t\tif (typeof(device[opt]) === \"number\") {\n\t\t\t\t\ttype = \"number\";\n\t\t\t\t\tif (!Number.isInteger(device[opt])) {\n\t\t\t\t\t\tstep = 0.01;\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof(device[opt]) === \"boolean\") {\n\t\t\t\t\ttype = \"checkbox\";\n\t\t\t\t\tif (device[opt] === true) {\n\t\t\t\t\t\tadditionalAttrb= \"checked\";\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof(device[opt]) === \"string\") {\n\t\t\t\t\tdevice[opt] = device[opt].replaceAll('\"', '&quot;');\n\t\t\t\t}\n\t\t\t\tholder.innerHTML += '<div class=\"stacked-input\"><label for=\"' + name + '\">' + opt + '</label>\\\n\t\t\t\t<input class=\"normal-input\" type=\"' + type + '\" name=\"' + name + '\" step=\"' + step + '\" value=\"' + device[opt] + '\" ' + additionalAttrb +'></div>';\n\t\t\t}\n\t\t}\n\t\tbuttons += '<button class=\"def-button\" onclick=\"updateDeviceConfig(' + holder.dataset.sensor + ',' + holder.dataset.posid + ')\">Update Config</button>';\n\t}\n\tif (holder.dataset.sensor === 'true') {\n\t\tconsole.log(holder.dataset.posid);\n\t\tbuttons += '<a class=\"def-button\" href=\"/calibrate.html?id=' + holder.dataset.posid + '\">Calibrate</a>';\n\t}\n\tbuttons += '</div>';\n\tholder.innerHTML += buttons;\n}\n\n// Parses and updates config for device\nfunction updateDeviceConfig(isSensor, posID) {\n\tlet inputs = document.querySelectorAll('#device input');\n\tlet new_config = {};\n\tArray.from(inputs).forEach((input) => {\n\t\tif (input.type === \"number\") {\n\t\t\tnew_config[input.name] = input.valueAsNumber;\n\t\t} else if (input.type === \"checkbox\") {\n\t\t\tnew_config[input.name] = input.checked;\n\t\t} else {\n\t\t\tnew_config[input.name] = input.value;\n\t\t}\n\t});\n\tinputs = document.querySelectorAll('#device select');\n\tArray.from(inputs).forEach((input) => {\n\t\tnew_config[input.name] = {\"current\": input.value};\n\t});\n\tconsole.log(new_config);\n\tif (isSensor) {\n\t\tPOSTRequest('/sensors/config', \"Device config updated!\", {'sensor': posID, 'config': JSON.stringify(new_config)});\n\t} else {\n\t\tPOSTRequest('/actors/config', \"Device config updated!\", {'actor': posID, 'config': JSON.stringify(new_config)});\n\t}\n}",
  "/www/devices.html": "\t<!--\n\tThis file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\n\tContributors: Sam Groveman\n\t-->\n\t<!DOCTYPE html>\n\t<html lang=\"en-us\">\n\t<head>        \n\t\t<link rel=\"stylesheet\" href=\"/main.css\">\n\t\t<script src=\"/ajax-script.js\"></script>\n\t\t<script src=\"/devices-script.js\"></script>\n\t\t<title>ESP32 Device Hub | Device Manager</title>\n\t</head>\n\t<body>\n\t\t<div id=\"wrapper\">\n\t\t\t<h1>Device Manager</h1>\n\t\t\t<h2>Select a device to manage it</h2>\n\t\t\t<div id=\"message\"></div>\n\t\t\t<div id=\"device\"></div>\n\t\t\t<h2>Sensors</h2>\n\t\t\t<div id=\"sensors\" class=\"button-container\">\n\t\t\t</div>\n\t\t\t<h2>Actors</h2>\n\t\t\t<div id=\"actors\" class=\"button-container\">\n\t\t\t</div>\n\t\t</div>\n\t</body>\n\t</html>",
  "/www/index-script.js": "/*\n * This file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\n * Contributors: Sam Groveman\n */\n\n// Run code when page DOM is loaded\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\n\t// Attach button handlers\n\tdocument.getElementById(\"reboot\").onclick = function() {\n\t\tPUTRequest('/reboot', 'Success, rebooting!');\n\t};\n\n\tdocument.getElementById(\"reset\").onclick = function() {\n\t\tif (confirm(\"Reset WiFi settings?\") == true) {\n\t\t\tPUTRequest('/reset', 'Success, rebooting!');\n\t\t}\n\t};\n\t\n\tdocument.getElementById(\"settime\").onclick = function() {\n\t\tPOSTRequest('/time', \"Time set\", { time:  Math.floor(new Date().getTime() / 1000) });\n\t};\n\n});",
  "/www/index.html": "<!--\nThis file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\nContributors: Sam Groveman\n-->\n<!DOCTYPE html>\n<html lang=\"en-us\">\n\t<head>        \n\t\t<link rel=\"stylesheet\" href=\"/main.css\">\n\t\t<script src=\"/ajax-script.js\"></script>\n\t\t<script src=\"/index-script.js\"></script>\n\t\t<title>ESP32 Device Hub</title>\n\t</head>\n\t<body>\n\t\t<div id=\"wrapper\">\n\t\t\t<h1>ESP32 Device Hub</h1>\n\t\t\t<h2>Use the buttons below to manage your device.</h2>\n\t\t\t<div id=\"message\"></div>\n\t\t\t<div class=\"button-container\">\n\t\t\t\t<button class=\"def-button\" id=\"settime\">Set Time On Device</button>\n\t\t\t\t<a class=\"def-button\" href=\"/devices.html\">Device Manager</a>\n\t\t\t\t<a class=\"def-button\" href=\"/storage.html\">Storage Manager</a>\n\t\t\t\t<a class=\"def-button\" href=\"/config.html\">Device Hub Settings</a>\n\t\t\t\t<a class=\"def-button\" href=\"/update\">Update Firmware</a>\n\t\t\t\t<button class=\"def-button\" id=\"reboot\">Reboot Device</button>\n\t\t\t\t<button class=\"def-button\" id=\"reset\">Reset WiFi Settings</button>\n\t\t\t</div>\n\t\t</div>\n\t</body>\n</html>",
  "/www/main.css": "/*\n * This file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\n * Contributors: Sam Groveman\n */\n\n#message {\n\tfont-size: 1.3em;\n\tfont-weight: bolder;\n}\n\nbody {\n\tbackground: #3498db;\n\tfont-family: sans-serif;\n\tfont-size: 1.2em;\n\tcolor: #777;\n}\n\n#wrapper {\n\tbackground: #fff;\n\tmax-width: 36em;\n\tmin-width: 26em;\n\tmargin: 25px auto;\n\tpadding: 30px;\n\tborder-radius: 5px;\n\ttext-align: center;\n}\n\n.button-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n}\n\n.def-button {\n\tmax-width: 25em;\n\tborder-radius: 4px;\n\tmargin: 10px;\n\tfont-size: 1.3em;\n\tbackground: #3498db;\n\tcolor: #fff;\n\tcursor: pointer;\n\tborder: 0;\n\tline-height: 44px;\n\ttext-decoration: none;\n\twidth: 100%;\n}\n\n#up-file {\n\tmax-width: 600px;\n\theight: 44px;\n\tborder-radius: 4px;\n\tmargin: 10px auto;\n\tfont-size: 17px;\n\tpadding: 0;\n\tborder: 1px solid #ddd;\n\tline-height: 44px;\n\ttext-align: left;\n\tdisplay: block;\n\tcursor: pointer;\n}\n\n#up-bar, #up-progress {\n\tbackground-color: #f1f1f1;\n\tborder-radius: 10px;\n\tposition: relative;\n}\n\n#up-progress {\n\tmargin: 10px auto;\n\tmax-width: 600px;\n}\n\n#up-bar {\n\tbackground-color: #3498db;\n\twidth: 0%;\n\theight: 30px;\n}\n\n#up-percent {\n\tposition: absolute;\n\ttop: 6px;\n\tleft: 0;\n\twidth: 100%;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\ttext-shadow: -1px 1px 0 #000, 1px 1px 0 #000, 1px -1px 0 #000, -1px -1px 0 #000;\n\tcolor: #fff;\n}\n\n.large-text {\n\tfont-size: 18px;\n}\n\ntable {\n\tmargin: 0 auto;\n}\n\n.file {\n\tfont-size: 20px;\n\tmargin: 5px;\n\ttext-align: left;\n}\n\n.file td {\n\tpadding: 5px 10px;\n}\n\n.delete, .download {\n\tcursor: pointer;\n\ttext-decoration: underline;\n}\n\n.delete {\n\tcolor: red; \n}\n\n.download {\n\tcolor: blue;\n}\n\n.normal-input {\n\tmargin: 8px auto;\n\tpadding: 12px 20px;\n\tborder: 1px solid #9b97a3;\n\tborder-radius: 4px;\n\tbox-sizing: border-box;\n\tfont-size: 20px;\n}\n\n.stacked-input {\n\tdisplay: block;\n}\n",
  "/www/storage-script.js": "/*\r\n* This file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\r\n* Contributors: Sam Groveman\r\n*/\r\n\r\n// Run code when page DOM is loaded\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n\t// Initialize the upload handler\r\n\tuprog.init();\r\n\r\n\t// Get server info\r\n\tgetFreeStorage();\r\n\tupdateFileList();\r\n\r\n\t// Attach button handlers\r\n\tdocument.getElementById(\"up-www\").onclick = function() {\r\n\t\tuprog.upload('/www');\r\n\t};\r\n\tdocument.getElementById(\"backup\").onclick = function() {\r\n\t\tdownloadBackup();\r\n\t};\r\n\tdocument.getElementById(\"restore\").onclick = function() {\r\n\t\trestoreBackup();\r\n\t};\r\n});\r\n\r\n// Update the list of files displayed on this page\r\nfunction updateFileList() {\r\n\tdocument.getElementById(\"file-list\").innerHTML = \"\";\r\n\tgetFileList(\"/\", 5);\r\n}\r\n\r\n// Get list of files\r\nfunction getFileList(filePath, traverseDepth = 0) {\r\n\tGETRequest(\"/list\", addFileList, { path: filePath, depth: 0 });\r\n\tGETRequest(\"/list\", addDirs, { path: filePath, type: 1, depth: traverseDepth });\r\n}\r\n\r\nlet filesLoaded = false;\r\n\r\n// Processes each directory one by one\r\nasync function addDirs(response) {\r\n\tif (response != null) {\r\n\t\tfor (let i = 0; i < response.list.length; i++)\r\n\t\t{\r\n\t\t\twhile (!filesLoaded) {\r\n\t\t\t\tawait new Promise(r => setTimeout(r, 10));\r\n\t\t\t}\r\n\t\t\tfilesLoaded = false;\r\n\t\t\tGETRequest(\"/list\", addFileList, { path: response.list[i], type: 0, depth: 0 });\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Callback for receiving file list data\r\nasync function addFileList(response) {\r\n\tif (response != null) {\r\n\t\tlet list = document.getElementById(\"file-list\");\r\n\t\tfor (let i = 0; i < response.list.length; i++)\r\n\t\t{\r\n\t\t\tlist.innerHTML += `\r\n\t\t\t<tr class=\"file\">\r\n\t\t\t\t<td>` + response.list[i] + `</td>\r\n\t\t\t\t<td class=\"download\"><a href=\"/download?path=` + response.list[i] + `\">Download</a>\r\n\t\t\t\t<td class=\"delete\" onclick=\"deleteFile(this)\" data-name=\"` + response.list[i] + `\">Delete</td>\r\n\t\t\t</tr>`;\r\n\t\t}\r\n\t}\r\n\tawait new Promise(r => setTimeout(r, 10));\r\n\tfilesLoaded = true;\r\n}\r\n\r\n// Delete file\r\nfunction deleteFile(file) {\r\n\tlet name = file.dataset.name;\r\n\tif (confirm(\"Delete \" + name + \"?\")) {\r\n\t\tPOSTRequest(\"/delete\", \"File deleted!\", { path: name }, fileDeleted);\r\n\t}\r\n}\r\n\r\n// Callback for file being deleted\r\nfunction fileDeleted(response) {\r\n\tlet file = document.querySelector('[data-name=\"' + response.file + '\"]');\r\n\tdocument.getElementById('message').innerHTML = 'File deleted!';\r\n\tfile.parentNode.remove();\r\n\tgetFreeStorage()\r\n}\r\n\r\n// Gets free storage space on device\r\nfunction getFreeStorage() {\r\n\tGETRequest(\"/freeSpace\", addFreeSpace);\r\n}\r\n\r\n// Callback for receiving free storage space\r\nfunction addFreeSpace(response) {\r\n\tif (response != null) {\r\n\t\tlet space = document.getElementById(\"freespace\");\r\n\t\tspace.innerHTML = 'Free space: ' + response.space + ' bytes';\r\n\t}\r\n}\r\n\r\n// Prepares a JSON file of all the config files for download\r\nasync function downloadBackup() {\r\n\tconst files = document.querySelectorAll('.file');\r\n\tlet backups = {};\r\n\tlet dots = 1;\r\n\tfor (const file of files) {\r\n\t\tdocument.getElementById('message').innerHTML = 'Backing up, please wait'\r\n\t\tfor (let i = 0; i < dots; i++) {\r\n\t\t\tdocument.getElementById('message').innerHTML += '.';\r\n\t\t}\r\n\t\tif (dots == 4) {\r\n\t\t\tdots = 0;\r\n\t\t} else {\r\n\t\t\tdots++;\r\n\t\t}\r\n\t\tlet response = await fetch(file.querySelector('.download a').getAttribute('href'));\r\n\t\tif (!response.ok) {\r\n\t\t\tconsole.log(`Response status: ${response.status}`);\r\n\t\t\tdocument.getElementById('message').innerHTML = 'Could not complete backup';\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tbackups[file.querySelector('.delete').dataset.name] = await response.text();\r\n\t\tawait new Promise(r => setTimeout(r, 50));\r\n\t}\r\n\tconst a = document.createElement('a');\r\n\ta.href = URL.createObjectURL( new Blob([JSON.stringify(backups, null, 2)], { type:'application/json' }) );\r\n\ta.download = \"Backup.json\";\r\n\ta.click();\r\n\ta.remove();\r\n\tdocument.getElementById('message').innerHTML = 'Backup successful!'\r\n}\r\n\r\n// Restores a backup from a JSON file\r\nasync function restoreBackup() {\r\n\tconst selectedFile = document.getElementById(\"up-file\").files[0];\r\n\tconst reader = new FileReader();\r\n\tdocument.getElementById('message').innerHTML = 'Beginning restore...';\r\n\treader.onload = async function(file) {\r\n\t\tlet files = JSON.parse(file.target.result);\r\n\t\tlet i = 0;\r\n\t\tlet restored = false;\r\n\t\tfor (let file in files) {\r\n\t\t\tPOSTRequest('/restorefile', 'File ' + file + ' restored', {\"path\": file, \"contents\": files[file]}, async function() {\r\n\t\t\t\tawait new Promise(r => setTimeout(r, 50))\r\n\t\t\t\trestored = true;\r\n\t\t\t});\r\n\t\t\t// Wait for file to be restored before proceeding\r\n\t\t\twhile (!restored) {\r\n\t\t\t\tawait new Promise(r => setTimeout(r, 50));\r\n\t\t\t}\r\n\t\t\trestored = false;\r\n\t\t}\r\n\t\tdocument.getElementById('message').innerHTML = 'Restore successful!';\r\n\t\tgetFreeStorage();\r\n\t\tupdateFileList();\r\n\t};\r\n\treader.readAsText(selectedFile);\r\n}",
  "/www/storage.html": "<!--\nThis file is licensed under the GPLv3 License Copyright (c) 2024 Sam Groveman\nContributors: Sam Groveman\n-->\n<!DOCTYPE html>\n<html lang=\"en-us\">\n\t<head>        \n\t\t<link rel=\"stylesheet\" href=\"/main.css\">\n\t\t<title>EESP32 Device Hub | Storage Management</title>\n\t\t<script src=\"/ajax-script.js\"></script>\n\t\t<script src=\"/storage-script.js\"></script>\n\t</head>\n\t<body>\n\t\t<div id=\"wrapper\">\n\t\t\t<h1>Storage Manager</h1>\n\t\t\t<div id=\"upload\">\n\t\t\t\t<h2>Select a file to upload it to the device.</h2>\n\t\t\t\t<h2 id=\"freespace\"></h2>\n\t\t\t\t<div id=\"up-progress\">\n\t\t\t\t\t<div id=\"up-bar\"></div>\n\t\t\t\t\t<div id=\"up-percent\">0%</div>\n\t\t\t\t</div>\n\t\t\t\t<input type=\"file\" id=\"up-file\" disabled>\n\t\t\t\t<div id=\"message\"></div>\n\t\t\t\t<div class=\"button-container\">\n\t\t\t\t\t<button class=\"def-button\" id=\"up-www\">Upload to WWW</button>\n\t\t\t\t\t<button class=\"def-button\" id=\"backup\">Backup</button>\n\t\t\t\t\t<button class=\"def-button\" id=\"restore\">Restore</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id=\"manage\">\n\t\t\t\t<h2>File List</h2>\n\t\t\t\t<table>\n\t\t\t\t\t<tbody id=\"file-list\">\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</body>\n</html>"
}